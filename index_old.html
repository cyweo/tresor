<!DOCTYPE html>
<html ng-app="tresor">
<head>
    <title>Chasse au trésor</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="pirate-icon.png" />
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-animate.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">    
    <link rel="stylesheet" type="text/css" href="theme.css"> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>    
<!--     <script src="tresor.js"></script> -->
</head>
<body ng-controller="langCtrl">
    <nav class="navbar navbar-inverse fixed shadow">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#Navbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>                        
                </button>
                <img id="siteImage" class="picto-sm img-responsive img-rounded" ng-src="{{ content.siteImage }}">
                <a class="navbar-brand" href="#">{{content.siteName[userLang] }}</a>
            </div>
            <div class="collapse navbar-collapse" id="Navbar">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">{{ content.chasseTitle[userLang] }}</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">                   
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;{{ content.label[userLang] }}
                            <span class="caret"></span>
                        </a>
                        <ul id="selectLang" class="nav dropdown-menu">
                            <li class="" ng-repeat="x in langs" ng-class="{'active': x.code == selectLang.active}" ng-click="selectLang.active=x.code;changeLang()">
                                <a href="#"><img ng-src="{{ x.code}}.png" class="flag">{{ x.name }}</a>
                            </li>
                        </ul>                        
                    </li>
                    <li><a href="#"><span class="glyphicon glyphicon-log-in"></span>&nbsp;&nbsp;{{ content.loginTitle[userLang] }}</a></li>
                </ul>
            </div>
        </div>
    </nav>   
    <div class="container">        
        <div id="title" class="page-header">
            <img id="headerImage" class="picto img-responsive img-rounded" src="coffre.jpg">
            <h1><span id="chasseTitle">{{ content.chasseTitle[userLang] }}</span></h1>
            <p id="chasseText">{{ content.chasseText[userLang] }}</p>
        </div>
        <div id="info" class="col-sm-12">
            <div id="alert" class="alert alert-info fade in" role="alert">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <img id="siteImage" class="picto img-responsive img(-rounded)" ng-src="{{content.siteImage }}">
                <p class="big">
                    <strong>{{ content.parcoursExplainTitle[userLang] }}</strong>
                  <br /><br />{{ content.parcoursExplainText[userLang] }}
                </p>
                <div class="text-right">
                  <button type="button" class="btn btn-success" data-dismiss="alert">{{ content.commons.start[userLang] }}</button>
                </div>
            </div>
        </div>
        <div id="parcours" class="col-sm-12">
            <h3 id="parcoursTitle">{{ content.parcoursTitle[userLang] }}</h3>
            <ul id="questions-nav" class="nav nav-pills nav-justified col-sm-12">
                <li id="item{{itemIndex}}" ng-repeat="(itemIndex, item) in questions" 
                    ng-class="{'active': itemIndex == itemSuivant}">
                    <a id="link{{itemIndex}}" class="big-bold" 
                       data-toggle="pill" href="#question{{itemIndex}}">
                        {{ content.tabTitle[userLang] }} {{itemIndex + 1 }}</a>
                </li>
            </ul>
        </div>
        <tabset id="questions-tabs" class="tab-content col-sm-12">   
            <br />  
            <tab id="question{{itemIndex}}" 
                 class="tab-pane col-sm-12 fade in" ng-class="{'active': itemIndex == itemSuivant}"
                 ng-repeat="(itemIndex, item) in questions">
                <div id="title" class="col-sm-12">
                    <img id="questionImage" class="picto img-responsive img-circle" 
                         ng-src="{{ item.questionImage }}">
                    <h3 id="questionTitle">{{ item.questionTitle[userLang] }}</h3>
                    <p id="questionText" class="big">{{ item.questionText[userLang] }}</p>
                </div>
                <div id="carte" class="col-sm-4 carte">
                    <h3 id="carteTitle" class="">{{ content.carteTitle[userLang] }}</h3>
                    <div id="carteContainer" class="carte-container">
                        <div id="carteButton" class="carte-zoom">
<!--                        Déclencheur de modale -->
                            <button type="button" class="btn btn-warning btn-lg" data-toggle="modal" data-target="#carteZoom{{itemIndex}}">
                                <span class="glyphicon glyphicon-search"></span>
                            </button>
                        </div>
                        <img id="carteImage" class="img-responsive img-rounded" ng-src="{{ item.carteImage }}">    
                    </div>
                    <p id="carteCaption" class="text-primary text-center">{{ item.carteCaption[userLang] }}</p>
<!--                Block modale début -->
                    <div id="carteZoom{{itemIndex}}" class="modal fade" role="dialog">
                        <div class="modal-dialog">
                            <!-- Modal content-->
                            <div id="modal" class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <img id="questionImage" class="picto-md img-responsive img-circle" ng-src="{{ item.questionImage }}">
                                        <h4 id="questionTitle">{{ item.questionTitle[userLang] }}</h4>
                                        <p id="questionText" class="medium">{{ item.questionText[userLang] }}</p>
                                </div>
                                <div class="modal-body">
                                    <img id="carteImage_modal" class="img-responsive img-rounded" ng-src="{{ item.carteImage }}">
                                    <p id="carteCaption_modal" class="text-primary text-center">{{ item.carteCaption[userLang] }}</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">{{ content.commons.fermer[userLang] }}</button>
                                </div>
                            </div>
                            <!-- End of modal -->
                        </div>
                    </div>
<!--                Block modale fin -->
                </div>
                <div id="indices" class="col-sm-4">
                    <h3 id="indicesTitle" class="">{{ content.indicesTitle[userLang] }}</h3>
                    <div id="indicesButtons" class="" ng-repeat="(indicIndex, indic) in item.indices">
                        <button type="button" class="btn spacer2" ng-click="afficher = true" 
                                ng-hide="afficher" ng-class="[{'btn-primary' : indicIndex == 0}, {'btn-warning' : indicIndex == 1}, {'btn-danger' : indicIndex == 2}]">
                            {{ content.commons.buttons[indicIndex][userLang] }}&nbsp;&nbsp;
<!--                             <span class="badge">{{ content.commons.buttonValue[indicIndex][userLang] }}</span> -->
                        </button>
                        <div id="info-{{ indicIndex }}" class="well-sm alert alert-info spacer1" role="alert" 
                             ng-show="afficher" 
                             ng-class="[{'alert-primary' : indicIndex == 0}, {'alert-warning' : indicIndex == 1}, {'alert-danger' : indicIndex == 2}]">
                            <strong>{{ indic[userLang]}}</strong>
                        </div>                       
                    </div>
                </div>
                <div id="control" class="col-sm-4">
                    <h3 id="controlTitle" class="">{{ content.controlTitle[userLang] }}</h3>
                    <p id="controlText" class="">{{ content.controlText[userLang] }}</p>
<!--                     j'ai trouvé : reponse -->
                    <button id="eureka" type="button" class="btn btn-success" 
                            data-toggle="collapse" data-target="#check" ng-hide="$scope.reponse" 
                            ng-click="$scope.reponse = 'true'">
                        {{ content.commons.eureka[userLang] }}</button>
                    <div id="check" class="panel panel-primary" ng-show="$scope.reponse">
                        <div id="checkTitle" class="panel-heading">
                            {{ content.checkTitle[userLang] }}
                        </div>
                        <div class="panel-body">
                            <div id="checkQuestion" class="">
                                {{ item.checkQuestion[userLang] }}
                            </div>
                            <div ng-repeat="(verifIndex, verif) in item.checkOptions">
                                <br />
                                <button type="submit" data-toggle="collapse" data-target="#check-{{ checkAnswer.active }}" 
                                        class="btn btn-sm btn-default indent" 
                                        ng-class="[{'btn-success': checkAnswer.active == 'true'  && verif.answer == 'true' && checkAnswer.button == verifIndex},{'btn-danger' : checkAnswer.active == 'false' && verif.answer == 'false' && checkAnswer.button == verifIndex}]" 
                                        ng-click="resetCheck();checkAnswer.active=verif.answer;checkAnswer.button=verifIndex;checkValue();">
                                    {{ verif[userLang] }}
                                </button><br />
                            </div>
                            <div id="switch" ng-switch on="check">
                                <div id="check-true" ng-switch-when="true">
                                    <br />
                                    <p id="reponseText" class="well-sm alert-success"><strong>{{ content.reponseTitle[userLang] }}</strong><br /><br />
                                    {{ item.reponseText[userLang] }}<br /><br />
                                    {{ content.commons.invite[userLang] }}&nbsp;&nbsp;
<!--                                     suivant  -->
                                    <button id="suivant" type="button" class="btn btn-warning" 
                                            ng-click="changeTresor()">
                                        {{ content.commons.suivant[userLang] }}</button>
                                    </p>
                                </div>
                                <div id="check-false" ng-switch-when="false" ng-hide="again">
                                    <br />
                                    <p id="error" class="well-sm alert-danger"><strong>{{ content.errorTitle[userLang] }}</strong><br /><br />
                                    {{ content.errorText[userLang] }}<br /><br />
                                    <button id="againButton" type="button" class="btn btn-danger" ng-click="again = true;resetCheck()">{{ content.commons.again[userLang] }}</button>                        
                                    </p>
                                </div>                            
                            </div>    
                        </div> 
                    </div>
                </div>
            </tab>
        </tabset>
    </div>
    <br/ >
    <div id="footer" class="container navbar well-sm alert-info"> 
        <p>&#169; 2016 cyweo.com - Jeux</p>
    </div>
    <script>
    var app = angular.module("tresor", []);     
    app.controller('langCtrl', function($scope, $http, $window, $log) {
        $scope.userLang = $window.navigator.language || $window.navigator.userLanguage; 
        $http.get("translations_tresor.js")
        .then(function (response) {
            $scope.content = response.data;
            $scope.questions = $scope.content.questions;
            $scope.langs = $scope.content.languages;
            var defaultLang = "";
            var listLang = [];            
            angular.forEach($scope.content.languages, function(value, key) {
                if (value.default == "true") {
                    defaultLang = key;
                }
                else {
                    this.push(key);
                }
                this.push(key);
            }, listLang);        
            if(listLang.indexOf($scope.userLang) == -1) {
                $scope.userLang = defaultLang; 
            };
            $scope.userLang = "fr";
            $scope.selectLang = {};
            $scope.selectLang.active = $scope.userLang;
            $scope.itemSuivant = 0;
            $scope.reponse = ""
            $log.log(" itemSuivant : "+$scope.itemSuivant);
            $scope.changeLang = function() {
                $scope.userLang = $scope.selectLang.active.toString();
            };
            $scope.itemMax = $scope.questions.length - 1;
            $scope.changeTresor = function() {
                $scope.itemSuivant = $scope.itemSuivant + 1;
                $scope.checkAnswer.active = "";
                $scope.check = "";
                $scope.again = "";
                $scope.reponse = "";
                $log.log("itemMax : "+$scope.itemMax+" itemSuivant : "+$scope.itemSuivant);
                if ( $scope.itemSuivant > $scope.itemMax ) {
                    $scope.itemSuivant = 0;
                    $scope.reponse = "false";
                    $log.log("itemMax >> : "+$scope.itemMax+" itemSuivant : "+$scope.itemSuivant);                    
                }
            };
            $log.log(" itemSuivant après fn: "+$scope.itemSuivant);
            $scope.checkAnswer = {};
            $scope.checkAnswer.active = "";
            $scope.checkAnswer.button = "";
            $scope.checkValue = function() {
                $scope.check = $scope.checkAnswer.active;         
            };
            $scope.resetCheck = function() {
                $scope.checkAnswer.active = "";
                $scope.check = "";
                $scope.again = "";
                $scope.reponse = "";
                $log.log("reset: "+$scope.itemSuivant+" reponse : "+$scope.reponse);
            };
        });
    });
    </script>  
</body>
</html>
